var common={};!function(a,b){a.log=function(a){try{console.log(a),console.trace()}catch(b){}},a._listeners={},a.bind=a.on=function(b,c){if(!b||!c)return a;var d=a._listeners;if(b.indexOf(" ")>0){types=b.split(" ");for(var e=0;e<types.length;e++)a.bind(types[e],c);return a}return"undefined"==typeof d[b]&&(d[b]=[]),"function"==typeof c&&d[b].push(c),a},a.fire=a.trigger=function(b,c){a.log("tigger:"+b);var d=a._listeners[b];if(d instanceof Array)for(var e=0,f=d.length;f>e;e+=1)"function"==typeof d[e]&&d[e](b,c);return a},a.unbind=function(b,c){var d=a._listeners[b];if("string"==typeof b&&d instanceof Array)if("function"==typeof c){for(var e=0,f=d.length;f>e;e+=1)if(d[e]===c){a._listeners[b].splice(e,1);break}}else delete a._listeners[b];return a},a.validate_rule={require:{test:function(a){return a+""?!0:!1},msg:"不能为空！"},maxlength:{test:function(a,b){return(a+"").length<=b},msg:"超过限制长度!"},minlength:{test:function(a,b){return(a+"").length>=b},msg:"文字太短！"},number:{test:function(a){return/^\d*$/.test(a)},msg:"必须全部是数字字符！"},password:{test:function(a){return/^[\w\.\$\d_]*$/.test(a)},msg:"密码只能由字母、数字、和下划线组成"}},a.validate_form=function(c){for(var d=c.find("[data-rule]"),e=!0,f=0;f<d.length;f++){var g=b(d[f]),h=b.parseJSON(g.attr("data-rule")),i=!0,j=g.next(),k=g.val();if(0!==k.length||h.require){for(var l in h)if(a.validate_rule[l]){var m=h[l];if(!a.validate_rule[l].test(k,m)){j.length>0&&j.addClass("error").text(a.validate_rule[l].msg).show(),e=!1,i=!1;break}}i&&j.length>0&&j.removeClass("error").text("").hide()}}return e},a.validate=function(c){return c?(b(c).submit(function(){return a.validate_form(b(this))}),c):!1},a.ajaxform=function(c,d){return c?(d||(d=function(){}),b(c).submit(function(){var c=b(this),e=a.validate_form(c);if(!e)return!1;for(var f,g={},h=c.find("input[name]"),i=c.find("textarea[name]"),j=c.find("select[name]"),k=h.length-1;k>=0;k--)f=b(h[k]),g[f.attr("name")]=f.val();for(k=i.length-1;k>=0;k--)f=b(i[k]),g[f.attr("name")]=f.val();for(k=j.length-1;k>=0;k--)f=b(j[k]),g[f.attr("name")]=f.val();return b.ajax(c.attr("action"),{data:g,method:b(this).attr("method"),dataType:"json",success:function(b){a.log(b),d(b)},error:function(a){d(b.parseJSON(a.responseText))}}),!1}),c):void 0},a.selectvalue=function(){var a=b("select[value]");a.each(function(a,c){c=b(c),c.val(c.attr("value"))})},a.querys=function(){for(var a,b=document.location.search,c=/(?:^\?|&)(.*?)=(.*?)(?=&|$)/g,d={};null!==(a=c.exec(b));)d[a[1]]=decodeURIComponent(a[2]);return d},a.query=function(a){return(document.location.search.match(new RegExp("(?:^\\?|&)"+a+"=(.*?)(?=&|$)"))||["",null])[1]},b(function(){a.selectvalue()})}(common,jQuery);